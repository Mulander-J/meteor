(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-17790f02"],{4190:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"meteor-admin-adCats"},[a("el-divider",{attrs:{"content-position":"left"}},[e._v("类目管理")]),a("el-collapse",{attrs:{accordion:""}},[a("el-collapse-item",{attrs:{title:"Search",name:"Search"}},[a("el-input",{staticStyle:{width:"200px","margin-right":"2rem"},attrs:{size:"small",placeholder:"输入关键字进行过滤",clearable:""},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),a("el-button",{attrs:{size:"small"},on:{click:e._getTreeData}},[e._v("刷新")])],1),a("el-collapse-item",{attrs:{title:"More",name:"More"}},[e._v(" 是否拖拽 "),a("el-switch",{attrs:{disabled:"","active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:e.treeOps.draggable,callback:function(t){e.$set(e.treeOps,"draggable",t)},expression:"treeOps.draggable"}})],1)],1),a("el-tree",{ref:"castTree",staticClass:"adCats-tree",attrs:{data:e.treeData,"v-loading":e.treeLoading,props:e.treeProps,draggable:e.treeOps.draggable,"node-key":"_id","default-expand-all":"","expand-on-click-node":!1,"allow-drag":e._allowDrag,"filter-node-method":e._filterNode},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,s=t.data;return a("p",{staticClass:"adCast-treeNode"},[a("span",{staticClass:"adCats-treeNode-name"},[e._v(e._s("No_"+s.sort+"."+r.label))]),a("span",[s.editable||"######"===s.parentId?a("el-button",{attrs:{icon:"el-icon-plus",type:"text",size:"mini"},on:{click:function(t){return e._handleModel(r,s,!1)}}},[e._v("新增")]):e._e(),s.editable?a("el-button",{attrs:{icon:"el-icon-edit",type:"text",size:"mini"},on:{click:function(t){return e._handleModel(r,s,!0)}}},[e._v("修改")]):e._e(),s.editable?a("el-button",{attrs:{icon:"el-icon-delete",type:"text",size:"mini"},on:{click:function(t){return e._handleRemove(r,s)}}},[e._v("删除")]):e._e()],1)])}}])}),a("el-dialog",{attrs:{title:"Model",visible:e.editShow,width:"max-content"},on:{"update:visible":function(t){e.editShow=t}}},[a("el-form",{attrs:{inline:"",model:e.formData,size:"small"}},[a("el-row",[a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{attrs:{placeholder:"名称"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1)],1),a("el-row",[a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{attrs:{type:"textarea",placeholder:"描述"},model:{value:e.formData.desc,callback:function(t){e.$set(e.formData,"desc",t)},expression:"formData.desc"}})],1)],1),a("el-row",[a("el-form-item",{attrs:{label:"父级"}},[a("el-input",{attrs:{placeholder:"父级",disabled:""},model:{value:e.formData.parentId,callback:function(t){e.$set(e.formData,"parentId",t)},expression:"formData.parentId"}})],1)],1),a("el-row",[a("el-form-item",{attrs:{label:"排序"}},[a("el-input-number",{attrs:{placeholder:"排序"},model:{value:e.formData.sort,callback:function(t){e.$set(e.formData,"sort",t)},expression:"formData.sort"}})],1)],1),a("el-row",[a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{placeholder:"备注"},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1)],1)],1),a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"success"},on:{click:e._handleSubmit}},[e._v("Submit")])],1)],1)],1)},s=[],n=(a("99af"),a("4de4"),a("4160"),a("c975"),a("a15b"),a("b0c0"),a("159b"),a("5530")),i={name:"AdCats",data:function(){return{filterText:"",treeProps:{id:"_id",children:"children",label:"name"},treeOps:{draggable:!1},treeData:[],editShow:!1,treeLoading:!1,defaultData:{name:"",parentId:"",desc:"",sort:0,editable:1,remark:""},formData:{name:"",parentId:"",desc:"",sort:0,editable:1,remark:""}}},watch:{filterText:function(e){this.$refs.castTree.filter(e)}},mounted:function(){this._getTreeData()},methods:{_getTreeData:function(){var e=this;this.treeLoading=!0,this.$api.cats.list({}).then((function(t){var a=t.data,r=a.success,s=a.result;r?e.treeData=e.$util._toTreeData(s,{id:"_id",parentId:"parentId",firstParent:"######",isSort:!0,sort:"sort"}):(e.treeData=[],e.$message.error(t.data.msg)),e.treeLoading=!1})).catch((function(t){e.treeData=[],e.$message.error(t.message),e.treeLoading=!1}))},_filterNode:function(e,t){return!e||-1!==t[this.treeProps.label].indexOf(e)},_allowDrag:function(e){return"######"!==e.data.parentId},_handleModel:function(e,t,a){this.formData=a?Object(n["a"])({},t):Object(n["a"])({},this.defaultData,{parentId:t[this.treeProps.id]}),this.editShow=!0},_handleSubmit:function(){var e=this;this.$api.cats.save(this.formData).then((function(t){t.data.success?(e.$message.success("保存成功"),e.editShow=!1,e._getTreeData()):e.$message.error(t.data.msg)})).catch((function(t){e.$message.error(t.message)}))},_handleRemove:function(e,t){if("######"!==t.name)if("UNCLASSIFIED"!==t.name){var a=this._recursiveChildren([t]).filter(Boolean),r=this;a.length>0&&this.$api.cats.delete(a.join(",")).then((function(e){e.data.success?(r.$message.success("删除成功！"),r._getTreeData()):r.$message.error(e.data.msg)})).catch((function(e){r.$message.error(e.message)}))}else this.$message.warning("未定义节点不能删除!");else this.$message.warning("根节点不能删除!")},_recursiveChildren:function(e){var t=this;if(!e||e.length<=0)return[];var a=[];return e.forEach((function(e){a.push(e[t.treeProps.id]),e[t.treeProps.children]&&(a=a.concat(t._recursiveChildren(e[t.treeProps.children])))})),a}}},l=i,o=(a("eb30"),a("2877")),c=Object(o["a"])(l,r,s,!1,null,"296872c5",null);t["default"]=c.exports},a15b:function(e,t,a){"use strict";var r=a("23e7"),s=a("44ad"),n=a("fc6a"),i=a("a640"),l=[].join,o=s!=Object,c=i("join",",");r({target:"Array",proto:!0,forced:o||!c},{join:function(e){return l.call(n(this),void 0===e?",":e)}})},eb30:function(e,t,a){"use strict";var r=a("fe3c"),s=a.n(r);s.a},fe3c:function(e,t,a){}}]);
//# sourceMappingURL=chunk-17790f02.9a81e459.js.map